<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clube Motors OS - Demo Funcional</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800;900&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; margin: 0; min-height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; overflow: hidden; }
        .hidden { display: none !important; }
        .fade-in { animation: fadeIn 0.3s ease-out forwards; }
        .slide-up { animation: slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.98); } to { opacity: 1; transform: scale(1); } }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }

        /* Device Frame */
        .device-frame {
            width: 100%; max-width: 420px; height: 850px;
            background: #fff; border-radius: 40px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            overflow: hidden; position: relative;
            border: 12px solid #1e293b;
        }

        /* Upload Box */
        .upload-box { transition: all 0.2s; border: 2px dashed #cbd5e1; background: #f8fafc; }
        .upload-box:active { transform: scale(0.95); }
        .upload-box.filled { border-style: solid; border-color: #10b981; background: #ecfdf5; color: #10b981; }
    </style>
</head>
<body>

    <div id="mode-selector" class="text-center text-white p-8 w-full max-w-md fade-in">
        <div class="mb-6 text-7xl animate-bounce">üõ†Ô∏è</div>
        <h1 class="text-4xl font-black mb-2 tracking-tight">Clube Motors</h1>
        <p class="text-slate-400 mb-10 text-sm">Demo de Checklist V2.0</p>
        
        <div class="space-y-4">
            <button onclick="switchMode('mechanic')" class="w-full bg-blue-600 hover:bg-blue-500 text-white p-4 rounded-xl font-bold flex items-center justify-center gap-3 transition">
                <i class="fa-solid fa-tablet-screen-button text-xl"></i> Acessar Mec√¢nico
            </button>
            <button onclick="switchMode('client')" class="w-full bg-emerald-600 hover:bg-emerald-500 text-white p-4 rounded-xl font-bold flex items-center justify-center gap-3 transition">
                <i class="fa-solid fa-mobile-screen text-xl"></i> Acessar Cliente
            </button>
        </div>
        <p class="mt-8 text-xs text-slate-500">Dica: Fa√ßa o fluxo do mec√¢nico primeiro.</p>
    </div>

    <div id="view-mechanic" class="device-frame hidden flex-col bg-slate-50 fade-in">
        
        <div class="bg-slate-900 text-white p-6 pt-10 rounded-b-[2rem] shadow-xl z-20">
            <div class="flex justify-between items-center mb-4">
                <div class="bg-blue-600 text-[10px] font-bold px-2 py-1 rounded">BOX 04</div>
                <button onclick="location.reload()" class="text-slate-400"><i class="fa-solid fa-power-off"></i></button>
            </div>
            <h2 class="text-2xl font-black">Ol√°, Junior</h2>
            <p class="text-sm text-slate-400">Selecione o ve√≠culo para iniciar.</p>
        </div>

        <div id="mech-dashboard" class="flex-1 overflow-y-auto p-4 space-y-3">
            <div onclick="startBudget('Chevrolet Onix', 'ABC-1234')" class="bg-white p-4 rounded-2xl shadow-sm border border-slate-200 active:scale-95 transition cursor-pointer flex justify-between items-center group hover:border-blue-400">
                <div class="flex gap-4 items-center">
                    <div class="w-12 h-12 bg-blue-50 rounded-full flex items-center justify-center text-blue-600">
                        <i class="fa-solid fa-car"></i>
                    </div>
                    <div>
                        <h3 class="font-bold text-slate-800">Chevrolet Onix</h3>
                        <p class="text-xs text-slate-500 font-mono">PLACA: ABC-1234</p>
                    </div>
                </div>
                <div class="text-right">
                    <span class="bg-blue-100 text-blue-700 text-[10px] font-bold px-2 py-1 rounded-full">INICIAR</span>
                    <i class="fa-solid fa-chevron-right text-slate-300 block mt-2 ml-auto"></i>
                </div>
            </div>
        </div>

        <div id="mech-checklist" class="hidden flex-1 flex flex-col h-full bg-slate-50 absolute top-0 w-full z-30 slide-up">
            <div class="bg-white p-4 pt-12 border-b border-slate-200 flex items-center gap-3 sticky top-0 z-40">
                <button onclick="closeBudget()" class="w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center text-slate-600"><i class="fa-solid fa-arrow-left"></i></button>
                <div>
                    <h2 class="font-bold text-slate-800 leading-none">Checklist Geral</h2>
                    <p class="text-xs text-slate-500 mt-1">Onix ‚Ä¢ ABC-1234</p>
                </div>
            </div>

            <div id="checklist-container" class="flex-1 overflow-y-auto p-4 pb-32 space-y-3">
                </div>

            <div class="absolute bottom-0 w-full p-4 bg-white border-t border-slate-100">
                <button onclick="sendBudgetToClient()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-xl shadow-lg flex items-center justify-center gap-2 transform active:scale-95 transition">
                    <i class="fa-solid fa-paper-plane"></i> FINALIZAR E ENVIAR
                </button>
            </div>
        </div>

        <div id="mech-modal" class="hidden absolute inset-0 bg-black/80 z-50 flex items-end sm:items-center justify-center backdrop-blur-sm fade-in">
            <div class="bg-white w-full h-[95%] sm:h-auto sm:max-h-[800px] sm:m-4 rounded-t-3xl sm:rounded-3xl shadow-2xl overflow-y-auto slide-up">
                
                <div class="p-5 border-b sticky top-0 bg-white z-10 flex justify-between items-center">
                    <div>
                        <span class="text-[10px] font-bold text-red-500 uppercase">Condenando Pe√ßa</span>
                        <h3 class="font-bold text-xl text-slate-800" id="modal-item-title">Item X</h3>
                    </div>
                    <button onclick="closeModal()" class="text-slate-400 bg-slate-100 w-8 h-8 rounded-full"><i class="fa-solid fa-times"></i></button>
                </div>

                <div class="p-6 space-y-6">
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-2">3 Fotos + 1 V√≠deo (Obrigat√≥rio)</label>
                        <div class="grid grid-cols-3 gap-2 mb-2">
                            <div onclick="fakeUpload(this)" class="upload-box h-20 rounded-lg flex items-center justify-center text-slate-400 cursor-pointer"><i class="fa-solid fa-camera"></i></div>
                            <div onclick="fakeUpload(this)" class="upload-box h-20 rounded-lg flex items-center justify-center text-slate-400 cursor-pointer"><i class="fa-solid fa-camera"></i></div>
                            <div onclick="fakeUpload(this)" class="upload-box h-20 rounded-lg flex items-center justify-center text-slate-400 cursor-pointer"><i class="fa-solid fa-camera"></i></div>
                        </div>
                        <div onclick="fakeUpload(this)" class="upload-box h-12 w-full rounded-lg flex items-center justify-center gap-2 text-slate-400 cursor-pointer">
                            <i class="fa-solid fa-video"></i> <span class="text-[10px] font-bold">V√çDEO (10s)</span>
                        </div>
                    </div>

                    <div class="bg-slate-50 p-4 rounded-xl border border-slate-200">
                        <label class="block text-xs font-bold text-blue-600 uppercase mb-3">Or√ßamento</label>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <span class="text-[10px] font-bold text-slate-400">PRE√áO MERCADO</span>
                                <div class="relative">
                                    <span class="absolute left-3 top-2.5 text-slate-400 text-sm">R$</span>
                                    <input type="number" id="input-market-price" oninput="calcModalPrice()" class="w-full pl-8 p-2 rounded-lg border border-slate-300 text-slate-600 font-bold" placeholder="0">
                                </div>
                            </div>
                            <div>
                                <span class="text-[10px] font-bold text-green-600">PRE√áO CLUBE</span>
                                <div class="relative">
                                    <span class="absolute left-3 top-2.5 text-green-600 font-bold">R$</span>
                                    <input type="text" id="input-club-price" readonly class="w-full pl-8 p-2 rounded-lg border-2 border-green-500 bg-white text-green-700 font-black" value="0,00">
                                </div>
                            </div>
                        </div>
                    </div>

                    <button onclick="saveIssue()" class="w-full bg-red-600 text-white font-bold py-4 rounded-xl shadow-lg hover:bg-red-700 transition">
                        CONFIRMAR PROBLEMA
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="view-client" class="device-frame hidden flex-col bg-white fade-in">
        <div class="bg-white/90 backdrop-blur p-4 pt-8 border-b border-slate-100 flex justify-between items-center sticky top-0 z-20">
            <div>
                <h3 class="font-black text-slate-900 text-lg tracking-tight">Clube<span class="text-blue-600">Motors</span></h3>
                <p class="text-[10px] text-slate-400 font-bold">OR√áAMENTO DIGITAL</p>
            </div>
            <div class="flex items-center gap-2 bg-green-50 px-3 py-1 rounded-full border border-green-100">
                <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                <span class="text-[10px] font-bold text-green-600">ONLINE</span>
            </div>
        </div>

        <div class="flex-1 overflow-y-auto bg-slate-50 p-4 pb-24">
            <div class="text-center mb-6 mt-2">
                <h2 class="text-xl font-bold text-slate-800">Resumo da An√°lise</h2>
                <p class="text-xs text-slate-500">Aprove os itens abaixo para iniciarmos.</p>
            </div>

            <div id="client-cards-container" class="space-y-4">
                <div class="text-center py-10 text-slate-400 text-sm">Aguardando an√°lise do mec√¢nico...</div>
            </div>

            <div id="client-footer-total" class="hidden mt-6 bg-white p-4 rounded-xl border border-slate-200 shadow-sm">
                <div class="flex justify-between items-end">
                    <span class="text-xs font-bold text-slate-500">Total Aprovado:</span>
                    <span class="text-2xl font-black text-green-600" id="total-price-display">R$ 0,00</span>
                </div>
                <button onclick="alert('Or√ßamento Aprovado! O servi√ßo come√ßar√° agora.')" class="w-full mt-3 bg-green-600 text-white font-bold py-3 rounded-lg shadow-lg">AUTORIZAR SERVI√áO</button>
            </div>
        </div>
    </div>

    <script>
        // --- DADOS DO SISTEMA ---
        const checklistItems = [
            "√ìleo do Motor", "Filtro de Ar", "Pastilha de Freio", 
            "Disco de Freio", "Suspens√£o Dianteira", "Pneus", 
            "Correia Dentada", "Bateria"
        ];
        
        let currentIssues = []; // Lista de problemas encontrados
        let currentEditingItem = ""; // Item sendo editado no modal

        // --- NAVEGA√á√ÉO ---
        function switchMode(mode) {
            document.getElementById('mode-selector').classList.add('hidden');
            if(mode === 'mechanic') {
                document.getElementById('view-mechanic').classList.remove('hidden');
                document.getElementById('view-mechanic').classList.add('flex');
            } else {
                document.getElementById('view-client').classList.remove('hidden');
                document.getElementById('view-client').classList.add('flex');
                loadClientView();
            }
        }

        // --- FUN√á√ïES DO MEC√ÇNICO ---
        function startBudget(car, plate) {
            document.getElementById('mech-dashboard').classList.add('hidden');
            document.getElementById('mech-checklist').classList.remove('hidden');
            renderChecklist();
        }

        function closeBudget() {
            document.getElementById('mech-checklist').classList.add('hidden');
            document.getElementById('mech-dashboard').classList.remove('hidden');
        }

        function renderChecklist() {
            const container = document.getElementById('checklist-container');
            container.innerHTML = ''; // Limpa

            checklistItems.forEach(item => {
                // Verifica se o item j√° foi condenado
                const issue = currentIssues.find(i => i.name === item);
                const statusClass = issue ? 'border-red-500 bg-red-50' : 'border-slate-100 bg-white';
                const statusIcon = issue ? '<i class="fa-solid fa-triangle-exclamation text-red-500"></i>' : '<i class="fa-regular fa-circle text-slate-300"></i>';

                const html = `
                <div class="p-4 rounded-xl border ${statusClass} shadow-sm transition">
                    <div class="flex justify-between items-center mb-3">
                        <div class="flex items-center gap-3">
                            ${statusIcon}
                            <span class="font-bold text-slate-700 text-sm">${item}</span>
                        </div>
                        ${issue ? `<span class="text-[10px] font-bold text-red-600 bg-red-100 px-2 py-1 rounded">CONDENADO: R$ ${issue.price}</span>` : ''}
                    </div>
                    
                    <div class="flex gap-2">
                        <button onclick="markOk(this)" class="flex-1 bg-slate-100 hover:bg-green-100 hover:text-green-700 text-slate-500 text-xs font-bold py-2 rounded-lg transition border border-slate-200">
                            <i class="fa-solid fa-check mr-1"></i> OK
                        </button>
                        <button onclick="openIssueModal('${item}')" class="flex-1 bg-slate-100 hover:bg-red-100 hover:text-red-700 text-slate-500 text-xs font-bold py-2 rounded-lg transition border border-slate-200">
                            <i class="fa-solid fa-wrench mr-1"></i> PROBLEMA
                        </button>
                    </div>
                </div>`;
                container.innerHTML += html;
            });
        }

        function markOk(btn) {
            // Visual simples para marcar OK
            btn.parentElement.parentElement.classList.remove('border-red-500', 'bg-red-50');
            btn.parentElement.parentElement.classList.add('border-green-500', 'bg-green-50');
            btn.innerHTML = '<i class="fa-solid fa-check-double mr-1"></i> VERIFICADO';
            btn.classList.add('bg-green-200', 'text-green-800');
        }

        // --- MODAL L√ìGICA ---
        function openIssueModal(item) {
            currentEditingItem = item;
            document.getElementById('modal-item-title').innerText = item;
            
            // Limpa inputs
            document.getElementById('input-market-price').value = '';
            document.getElementById('input-club-price').value = '0,00';
            document.querySelectorAll('.upload-box').forEach(b => {
                b.classList.remove('filled');
                b.innerHTML = b.innerHTML.includes('camera') ? '<i class="fa-solid fa-camera"></i>' : '<i class="fa-solid fa-video"></i> <span class="text-[10px] font-bold">V√çDEO (10s)</span>';
            });

            document.getElementById('mech-modal').classList.remove('hidden');
            document.getElementById('mech-modal').classList.add('flex');
        }

        function closeModal() {
            document.getElementById('mech-modal').classList.add('hidden');
            document.getElementById('mech-modal').classList.remove('flex');
        }

        function fakeUpload(el) {
            el.classList.add('filled');
            el.innerHTML = '<i class="fa-solid fa-check text-xl"></i>';
        }

        function calcModalPrice() {
            let market = parseFloat(document.getElementById('input-market-price').value);
            if(isNaN(market)) market = 0;
            let club = market * 0.8; // Regra de 20% desconto
            document.getElementById('input-club-price').value = club.toLocaleString('pt-BR', {minimumFractionDigits: 2});
        }

        function saveIssue() {
            const marketPrice = document.getElementById('input-market-price').value;
            const clubPrice = document.getElementById('input-club-price').value;

            if(!marketPrice) {
                alert("Digite o pre√ßo de mercado.");
                return;
            }

            // Remove se j√° existia e adiciona novo
            currentIssues = currentIssues.filter(i => i.name !== currentEditingItem);
            currentIssues.push({
                name: currentEditingItem,
                market: marketPrice,
                price: clubPrice
            });

            closeModal();
            renderChecklist(); // Atualiza a lista visualmente
        }

        // --- ENVIO PARA CLIENTE ---
        function sendBudgetToClient() {
            if(currentIssues.length === 0) {
                alert("Nenhum problema apontado. O carro est√° perfeito?");
                // Poderia enviar checklist limpo, mas pra demo vamos exigir 1 problema
                return;
            }
            // Salva no LocalStorage pro cliente ler
            localStorage.setItem('clubemotors_budget', JSON.stringify(currentIssues));
            alert("üöÄ OR√áAMENTO ENVIADO!\n\nAgora acesse o modo CLIENTE para ver os itens.");
            location.reload();
        }

        // --- FUN√á√ïES DO CLIENTE ---
        function loadClientView() {
            const data = localStorage.getItem('clubemotors_budget');
            const container = document.getElementById('client-cards-container');
            const footer = document.getElementById('client-footer-total');
            
            if(!data) {
                container.innerHTML = '<div class="text-center py-10 text-slate-400">Nenhum or√ßamento pendente.</div>';
                return;
            }

            const issues = JSON.parse(data);
            container.innerHTML = '';
            let total = 0;

            issues.forEach((issue, index) => {
                // Converte pre√ßo string "1.000,00" pra float pra somar
                let priceFloat = parseFloat(issue.price.replace('.','').replace(',','.'));
                total += priceFloat;

                const cardHtml = `
                <div id="card-${index}" class="bg-white rounded-2xl shadow-sm border border-red-100 overflow-hidden mb-4 slide-up" style="animation-delay: ${index * 0.1}s">
                    <div class="bg-red-50 p-3 flex justify-between items-center border-b border-red-100">
                        <div class="flex items-center gap-2">
                            <i class="fa-solid fa-circle-exclamation text-red-500"></i>
                            <span class="font-bold text-slate-800">${issue.name}</span>
                        </div>
                        <span class="text-[10px] font-bold text-red-500 bg-white px-2 py-1 rounded border border-red-100">CR√çTICO</span>
                    </div>
                    <div class="p-4">
                        <div class="grid grid-cols-3 gap-2 mb-3">
                            <div class="bg-slate-100 h-16 rounded bg-cover bg-center" style="background-image: url('https://images.unsplash.com/photo-1486262715619-67b85e0b08d3?w=100')"></div>
                            <div class="bg-slate-100 h-16 rounded bg-cover bg-center" style="background-image: url('https://images.unsplash.com/photo-1626245341236-412cb283e459?w=100')"></div>
                            <div class="bg-slate-900 h-16 rounded flex items-center justify-center text-white"><i class="fa-solid fa-play"></i></div>
                        </div>
                        <div class="flex justify-between items-center bg-slate-50 p-3 rounded-lg border border-slate-100 mb-3">
                            <span class="text-xs text-slate-400 line-through">R$ ${parseFloat(issue.market).toLocaleString('pt-BR', {minimumFractionDigits: 2})}</span>
                            <span class="text-xl font-black text-green-600">R$ ${issue.price}</span>
                        </div>
                        <button onclick="approveItem(${index}, this)" class="w-full bg-slate-200 hover:bg-green-600 hover:text-white text-slate-600 font-bold py-3 rounded-xl transition">
                            APROVAR ITEM
                        </button>
                    </div>
                </div>`;
                container.innerHTML += cardHtml;
            });

            document.getElementById('total-price-display').innerText = "R$ " + total.toLocaleString('pt-BR', {minimumFractionDigits: 2});
            footer.classList.remove('hidden');
        }

        function approveItem(index, btn) {
            btn.classList.remove('bg-slate-200', 'text-slate-600');
            btn.classList.add('bg-green-600', 'text-white');
            btn.innerHTML = '<i class="fa-solid fa-check"></i> APROVADO';
            btn.disabled = true;
        }

    </script>
</body>
</html>

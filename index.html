<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clube Motors OS - Demo Oficial</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800;900&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; margin: 0; min-height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; overflow: hidden; }
        .hidden { display: none !important; }
        .fade-in { animation: fadeIn 0.4s ease-out forwards; }
        .slide-up { animation: slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.98); } to { opacity: 1; transform: scale(1); } }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }

        /* Device Frame */
        .device-frame {
            width: 100%; max-width: 420px; height: 850px;
            background: #fff; border-radius: 40px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            overflow: hidden; position: relative;
            border: 12px solid #1e293b;
        }

        /* Timeline Vertical */
        .timeline-line { position: absolute; left: 19px; top: 10px; bottom: 0; width: 2px; background: #e2e8f0; z-index: 0; }
        .timeline-item { position: relative; z-index: 10; display: flex; gap: 12px; padding-bottom: 24px; }
        .dot { width: 16px; height: 16px; border-radius: 50%; background: #e2e8f0; border: 2px solid #fff; box-shadow: 0 2px 4px rgba(0,0,0,0.1); flex-shrink: 0; margin-top: 4px; }
        .dot.active { background: #10b981; border-color: #fff; }
        .dot.current { background: #3b82f6; box-shadow: 0 0 0 4px #dbeafe; animation: pulse 2s infinite; }
        
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.4); } 70% { box-shadow: 0 0 0 10px rgba(59, 130, 246, 0); } 100% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); } }

        /* Upload Box */
        .upload-box { transition: all 0.2s; border: 2px dashed #cbd5e1; background: #f8fafc; }
        .upload-box:active { transform: scale(0.95); }
        .upload-box.filled { border-style: solid; border-color: #10b981; background: #ecfdf5; color: #10b981; }
    </style>
</head>
<body>

    <div id="mode-selector" class="text-center text-white p-8 w-full max-w-md fade-in">
        <div class="mb-6 text-7xl animate-bounce">üõ†Ô∏è</div>
        <h1 class="text-4xl font-black mb-2 tracking-tight">Clube Motors</h1>
        <p class="text-slate-400 mb-10 text-sm">Demo Oficial v2.0</p>
        
        <div class="space-y-4">
            <button onclick="switchMode('mechanic')" class="w-full bg-blue-600 hover:bg-blue-500 text-white p-4 rounded-xl font-bold flex items-center justify-center gap-3 transition shadow-lg border border-blue-400">
                <i class="fa-solid fa-tablet-screen-button text-xl"></i> Acessar Oficina
            </button>
            <button onclick="switchMode('client')" class="w-full bg-emerald-600 hover:bg-emerald-500 text-white p-4 rounded-xl font-bold flex items-center justify-center gap-3 transition shadow-lg border border-emerald-400">
                <i class="fa-solid fa-mobile-screen text-xl"></i> Acessar Cliente
            </button>
        </div>
        
        <div class="mt-8 p-4 bg-slate-800 rounded-lg text-xs text-slate-400 text-left">
            <strong>Instru√ß√£o de Demo:</strong><br>
            1. Entre como <strong>Oficina</strong> e inicie o atendimento.<br>
            2. Veja o Alerta do Fabricante.<br>
            3. Aponte defeitos e suba fotos (Velha x Nova).<br>
            4. Envie e entre como <strong>Cliente</strong> para aprovar.
        </div>
    </div>

    <div id="view-mechanic" class="device-frame hidden flex-col bg-slate-50 fade-in">
        <div class="bg-slate-900 text-white p-6 pt-10 rounded-b-[2rem] shadow-xl z-20">
            <div class="flex justify-between items-center mb-4">
                <div class="bg-blue-600 text-[10px] font-bold px-2 py-1 rounded">BOX 04</div>
                <button onclick="location.reload()" class="text-slate-400"><i class="fa-solid fa-power-off"></i></button>
            </div>
            <h2 class="text-2xl font-black">Painel Oficina</h2>
            <p class="text-sm text-slate-400">Fila de Atendimento</p>
        </div>

        <div id="mech-dashboard" class="flex-1 overflow-y-auto p-4 space-y-3">
            <div onclick="showAlert()" class="bg-white p-4 rounded-2xl shadow-sm border border-slate-200 active:scale-95 transition cursor-pointer flex justify-between items-center group hover:border-blue-400">
                <div class="flex gap-4 items-center">
                    <div class="w-12 h-12 bg-blue-50 rounded-full flex items-center justify-center text-blue-600">
                        <i class="fa-solid fa-car"></i>
                    </div>
                    <div>
                        <h3 class="font-bold text-slate-800">Chevrolet Onix</h3>
                        <p class="text-xs text-slate-500 font-mono">PLACA: ABC-1234</p>
                    </div>
                </div>
                <div class="text-right">
                    <span class="bg-blue-100 text-blue-700 text-[10px] font-bold px-2 py-1 rounded-full">INICIAR</span>
                    <i class="fa-solid fa-chevron-right text-slate-300 block mt-2 ml-auto"></i>
                </div>
            </div>
        </div>

        <div id="manufacturer-alert" class="hidden absolute inset-0 bg-slate-900/95 z-50 flex items-center justify-center p-4 fade-in">
            <div class="bg-white rounded-2xl shadow-2xl w-full max-w-sm overflow-hidden">
                <div class="bg-yellow-400 p-4 flex items-center gap-3">
                    <i class="fa-solid fa-triangle-exclamation text-slate-900 text-2xl"></i>
                    <h3 class="font-black text-slate-900 text-lg uppercase leading-tight">Aten√ß√£o<br>Mec√¢nico</h3>
                </div>
                <div class="p-6">
                    <p class="text-sm font-bold text-slate-600 mb-4">N√£o se esque√ßa das Recomenda√ß√µes do Fabricante:</p>
                    <ul class="space-y-3">
                        <li class="flex items-start gap-2 bg-slate-50 p-2 rounded-lg">
                            <i class="fa-solid fa-circle-check text-blue-500 mt-1"></i>
                            <span class="text-xs font-semibold text-slate-700"><strong>Amortecedores:</strong> a cada 40.000km</span>
                        </li>
                        <li class="flex items-start gap-2 bg-slate-50 p-2 rounded-lg">
                            <i class="fa-solid fa-circle-check text-blue-500 mt-1"></i>
                            <span class="text-xs font-semibold text-slate-700"><strong>Molas:</strong> a cada 3 anos ("fadigam")</span>
                        </li>
                        <li class="flex items-start gap-2 bg-slate-50 p-2 rounded-lg">
                            <i class="fa-solid fa-circle-check text-blue-500 mt-1"></i>
                            <span class="text-xs font-semibold text-slate-700"><strong>Fluido de Freio:</strong> 1x ao ano</span>
                        </li>
                        <li class="flex items-start gap-2 bg-slate-50 p-2 rounded-lg">
                            <i class="fa-solid fa-circle-check text-blue-500 mt-1"></i>
                            <span class="text-xs font-semibold text-slate-700"><strong>Correia Dentada:</strong> 40.000km ou 2 anos</span>
                        </li>
                    </ul>
                    <button onclick="startChecklist()" class="w-full mt-6 bg-slate-900 text-white font-bold py-3 rounded-xl shadow-lg hover:bg-slate-800 transition">
                        ENTENDI, INICIAR ORDEM DE SERVI√áO
                    </button>
                </div>
            </div>
        </div>

        <div id="mech-checklist" class="hidden flex-1 flex flex-col h-full bg-slate-50 absolute top-0 w-full z-30 slide-up">
            <div class="bg-white p-4 pt-12 border-b border-slate-200 flex items-center gap-3 sticky top-0 z-40">
                <button onclick="closeChecklist()" class="w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center text-slate-600"><i class="fa-solid fa-arrow-left"></i></button>
                <div>
                    <h2 class="font-bold text-slate-800 leading-none">Checklist Completo</h2>
                    <p class="text-xs text-slate-500 mt-1">Onix ‚Ä¢ ABC-1234</p>
                </div>
            </div>

            <div id="checklist-items" class="flex-1 overflow-y-auto p-4 pb-32 space-y-4">
                </div>

            <div class="absolute bottom-0 w-full p-4 bg-white border-t border-slate-100">
                <button onclick="sendBudget()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-xl shadow-lg flex items-center justify-center gap-2 transform active:scale-95 transition">
                    <i class="fa-solid fa-paper-plane"></i> ENVIAR PARA O CLIENTE
                </button>
            </div>
        </div>

        <div id="mech-modal" class="hidden absolute inset-0 bg-black/80 z-50 flex items-end sm:items-center justify-center backdrop-blur-sm fade-in">
            <div class="bg-white w-full h-[95%] sm:h-auto sm:max-h-[800px] sm:m-4 rounded-t-3xl sm:rounded-3xl shadow-2xl overflow-y-auto slide-up">
                
                <div class="p-5 border-b sticky top-0 bg-white z-10 flex justify-between items-center">
                    <div>
                        <span class="text-[10px] font-bold text-red-500 uppercase">Apontando Falha</span>
                        <h3 class="font-bold text-xl text-slate-800" id="modal-title">Pe√ßa</h3>
                    </div>
                    <button onclick="closeModal()" class="text-slate-400 w-8 h-8 rounded-full bg-slate-100"><i class="fa-solid fa-times"></i></button>
                </div>

                <div class="p-6 space-y-6">
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-2">Evid√™ncias Visuais (Obrigat√≥rio)</label>
                        <div class="grid grid-cols-2 gap-3 mb-2">
                            <div onclick="fakeUpload(this)" class="upload-box h-24 rounded-lg flex flex-col items-center justify-center text-slate-400 cursor-pointer text-center p-2">
                                <i class="fa-solid fa-camera mb-1"></i>
                                <span class="text-[9px] font-bold">PE√áA VELHA<br>(DANIFICADA)</span>
                            </div>
                            <div onclick="fakeUpload(this)" class="upload-box h-24 rounded-lg flex flex-col items-center justify-center text-slate-400 cursor-pointer text-center p-2">
                                <i class="fa-solid fa-box-open mb-1"></i>
                                <span class="text-[9px] font-bold">PE√áA NOVA<br>(COMO DEVE SER)</span>
                            </div>
                        </div>
                        <div onclick="fakeUpload(this)" class="upload-box h-12 w-full rounded-lg flex items-center justify-center gap-2 text-slate-400 cursor-pointer">
                            <i class="fa-solid fa-video"></i> <span class="text-[10px] font-bold">V√çDEO DO PROBLEMA (10s)</span>
                        </div>
                    </div>

                    <div class="bg-slate-50 p-4 rounded-xl border border-slate-200">
                        <label class="block text-xs font-bold text-blue-600 uppercase mb-3">Defini√ß√£o de Valores</label>
                        <div class="grid grid-cols-1 gap-4">
                            <div>
                                <span class="text-[10px] font-bold text-green-600">VALOR CLUBE MOTORS (Voc√™ Digita)</span>
                                <div class="relative">
                                    <span class="absolute left-3 top-3 text-green-600 font-bold">R$</span>
                                    <input type="number" id="input-club-price" oninput="calcMarketPrice()" class="w-full pl-10 p-3 rounded-lg border-2 border-green-500 bg-white text-green-700 font-black text-lg focus:outline-none focus:ring-2 focus:ring-green-200" placeholder="0,00">
                                </div>
                            </div>
                            
                            <div>
                                <span class="text-[10px] font-bold text-slate-400">VALOR DE MERCADO (Autom√°tico +40%)</span>
                                <div class="relative">
                                    <span class="absolute left-3 top-3 text-slate-400 text-sm">R$</span>
                                    <input type="text" id="input-market-price" readonly class="w-full pl-10 p-3 rounded-lg border border-slate-300 bg-slate-100 text-slate-500 font-bold" value="0,00">
                                </div>
                                <p class="text-[10px] text-slate-400 mt-1">*Adicionado margem de mercado automaticamente.</p>
                            </div>
                        </div>
                    </div>

                    <button onclick="confirmIssue()" class="w-full bg-red-600 text-white font-bold py-4 rounded-xl shadow-lg hover:bg-red-700 transition">
                        CONFIRMAR E SALVAR
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="view-client" class="device-frame hidden flex-col bg-white fade-in">
        
        <div class="bg-white/90 backdrop-blur p-4 pt-8 border-b border-slate-100 flex justify-between items-center sticky top-0 z-20">
            <div>
                <h3 class="font-black text-slate-900 text-lg tracking-tight">Clube<span class="text-blue-600">Motors</span></h3>
                <p class="text-[10px] text-slate-400 font-bold">ACOMPANHAMENTO ONLINE</p>
            </div>
            <div id="status-badge" class="flex items-center gap-2 bg-slate-100 px-3 py-1 rounded-full border border-slate-200">
                <div class="w-2 h-2 bg-slate-400 rounded-full"></div>
                <span class="text-[10px] font-bold text-slate-500">CONECTADO</span>
            </div>
        </div>

        <div class="flex-1 overflow-y-auto bg-slate-50 pb-20">
            
            <div class="bg-white p-6 border-b border-slate-100 mb-4">
                <h3 class="text-xs font-bold text-slate-400 uppercase tracking-wider mb-6">Status do Ve√≠culo</h3>
                <div class="relative pl-2">
                    <div class="timeline-line"></div>
                    
                    <div class="timeline-item">
                        <div class="dot active"></div>
                        <div>
                            <p class="text-xs font-bold text-slate-800">Ve√≠culo Recebido</p>
                            <p class="text-[10px] text-slate-400">08:00 ‚Ä¢ Recep√ß√£o</p>
                        </div>
                    </div>

                    <div class="timeline-item">
                        <div id="dot-analyzing" class="dot current"></div>
                        <div>
                            <p class="text-xs font-bold text-slate-800">Em An√°lise T√©cnica</p>
                            <p class="text-[10px] text-slate-400">Mec√¢nico est√° verificando itens...</p>
                        </div>
                    </div>

                    <div class="timeline-item opacity-50" id="step-budget">
                        <div id="dot-budget" class="dot"></div>
                        <div>
                            <p class="text-xs font-bold text-slate-800">Or√ßamento Dispon√≠vel</p>
                        </div>
                    </div>

                    <div class="timeline-item opacity-50" id="step-maintenance">
                        <div id="dot-maintenance" class="dot"></div>
                        <div>
                            <p class="text-xs font-bold text-slate-800">Em Manuten√ß√£o</p>
                        </div>
                    </div>

                    <div class="timeline-item opacity-50" id="step-ready">
                        <div id="dot-ready" class="dot"></div>
                        <div>
                            <p class="text-xs font-bold text-slate-800">Pronto para Retirada</p>
                        </div>
                    </div>
                </div>
            </div>

            <div id="client-content" class="p-4">
                
                <div id="state-waiting" class="text-center py-10">
                    <div class="animate-spin w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full mx-auto mb-4"></div>
                    <p class="text-sm font-bold text-slate-600">Aguardando envio da oficina...</p>
                    <p class="text-xs text-slate-400 mt-2">Voc√™ ser√° notificado assim que a an√°lise terminar.</p>
                </div>

                <div id="state-budget" class="hidden">
                    <div class="bg-red-50 border border-red-100 p-4 rounded-xl mb-4 text-center">
                        <p class="text-sm font-bold text-red-600"><i class="fa-solid fa-triangle-exclamation"></i> A√ß√£o Necess√°ria</p>
                        <p class="text-xs text-red-400">Aprove os itens abaixo para continuar.</p>
                    </div>
                    
                    <div id="budget-list" class="space-y-4">
                        </div>

                    <div class="mt-6 bg-white p-4 rounded-xl shadow-sm border border-slate-200">
                        <div class="flex justify-between items-end mb-4">
                            <span class="text-xs font-bold text-slate-500">Total Clube Motors:</span>
                            <span class="text-2xl font-black text-green-600" id="total-amount">R$ 0,00</span>
                        </div>
                        <button onclick="authorizeService()" class="w-full bg-green-600 text-white font-bold py-4 rounded-xl shadow-lg hover:bg-green-700 transition">
                            AUTORIZAR SERVI√áO
                        </button>
                    </div>
                </div>

                <div id="state-maintenance" class="hidden text-center py-8">
                    <div class="w-24 h-24 bg-blue-50 rounded-full flex items-center justify-center mx-auto mb-4 relative">
                        <i class="fa-solid fa-gear text-4xl text-blue-500 animate-spin-slow"></i>
                        <div class="absolute -right-2 -bottom-2 bg-white p-2 rounded-full shadow"><i class="fa-solid fa-wrench text-slate-400"></i></div>
                    </div>
                    <h2 class="text-xl font-bold text-slate-800">M√£os √† obra!</h2>
                    <p class="text-sm text-slate-500 mt-2 px-6">O mec√¢nico Junior j√° iniciou os reparos autorizados. O tempo estimado √© de 2 horas.</p>
                    
                    <button onclick="advanceToReady()" class="mt-12 bg-slate-800 text-white text-xs font-bold py-3 px-6 rounded-full opacity-80 hover:opacity-100 transition">
                        üõ†Ô∏è SIMULAR CONTINUAR FLUXO (Demo)
                    </button>
                </div>

                <div id="state-ready" class="hidden text-center py-8 fade-in">
                    <div class="w-24 h-24 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6 shadow-lg shadow-green-100">
                        <i class="fa-solid fa-check text-4xl text-green-600"></i>
                    </div>
                    <h2 class="text-2xl font-black text-slate-800">Tudo Pronto!</h2>
                    <p class="text-sm text-slate-500 mt-2">Seu ve√≠culo j√° pode ser retirado.</p>
                    
                    <div class="mt-8 bg-white p-6 rounded-2xl shadow-sm border border-slate-100 text-left">
                        <p class="text-[10px] font-bold text-slate-400 uppercase mb-2">Local de Retirada</p>
                        <h3 class="font-bold text-slate-800 text-lg">Oficina Clube Motors - Zona Sul</h3>
                        <p class="text-sm text-slate-500 mt-1">Av. das Na√ß√µes Unidas, 1234<br>Box 04 ‚Ä¢ Mec√¢nico Junior</p>
                        
                        <button class="w-full mt-4 bg-slate-100 text-slate-600 font-bold py-3 rounded-lg flex items-center justify-center gap-2">
                            <i class="fa-solid fa-map-location-dot"></i> COMO CHEGAR
                        </button>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script>
        // DADOS DO CHECKLIST (CATEGORIZADO E COMPLETO)
        const checklistData = {
            "Visual": [
                "Luzes dianteiras", "Luzes traseiras", "Troca de √≥leo", "Luzes inje√ß√£o eletr√¥nica"
            ],
            "Suspens√£o": [
                "Pneus", "Balanceamento", "Alinhamento", "V√°lvulas", "Roda", "Piv√¥", 
                "Terminal dire√ß√£o", "Terminal axial", "Buchas", "Amortecedor dianteiro", 
                "Amortecedor traseiro", "Mola dianteira", "Mola traseira", 
                "Kits de amortecedor", "Coxim de amortecedor", "Bieletas"
            ],
            "Freio": [
                "Pastilha dianteira", "Pastilha/Lona traseira", "Disco dianteiro", 
                "Disco/Tambor traseiro", "Fluido de freio"
            ],
            "Mec√¢nica": [
                "Correia dentada", "Filtro combust√≠vel", "Filtro ar", "Filtro p√≥lem", 
                "√ìleo motor", "Filtro √≥leo", "Vela", "Correias auxiliares", 
                "Limpeza sistema de inje√ß√£o"
            ]
        };

        let issues = JSON.parse(localStorage.getItem('cm_issues') || '[]');
        let clientStage = localStorage.getItem('cm_stage') || 'analyzing'; 

        // NAVEGA√á√ÉO
        function switchMode(mode) {
            document.getElementById('mode-selector').classList.add('hidden');
            if(mode === 'mechanic') {
                document.getElementById('view-mechanic').classList.remove('hidden');
                document.getElementById('view-mechanic').classList.add('flex');
                // N√£o renderiza checklist ainda, espera o alerta
            } else {
                document.getElementById('view-client').classList.remove('hidden');
                document.getElementById('view-client').classList.add('flex');
                updateClientUI();
            }
        }

        // --- L√ìGICA OFICINA ---
        
        // Passo 1: Mostrar Alerta ao Clicar no Carro
        function showAlert() {
            document.getElementById('mech-dashboard').classList.add('hidden');
            document.getElementById('manufacturer-alert').classList.remove('hidden');
        }

        // Passo 2: Iniciar Checklist ap√≥s ler alerta
        function startChecklist() {
            document.getElementById('manufacturer-alert').classList.add('hidden');
            document.getElementById('mech-checklist').classList.remove('hidden');
            renderChecklist();
        }

        function closeChecklist() {
            document.getElementById('mech-checklist').classList.add('hidden');
            document.getElementById('mech-dashboard').classList.remove('hidden');
        }

        function renderChecklist() {
            const container = document.getElementById('checklist-items');
            container.innerHTML = '';
            
            // Loop pelas categorias
            for (const [category, items] of Object.entries(checklistData)) {
                // T√≠tulo da Categoria
                container.innerHTML += `<h3 class="font-black text-slate-400 text-xs uppercase tracking-widest mt-4 mb-2 pl-2 border-l-4 border-blue-500">${category}</h3>`;
                
                // Itens da Categoria
                items.forEach(item => {
                    const issue = issues.find(i => i.name === item);
                    const style = issue ? 'border-red-500 bg-red-50' : 'border-slate-100 bg-white';
                    
                    container.innerHTML += `
                    <div class="p-3 rounded-xl border ${style} shadow-sm flex justify-between items-center bg-white mb-2">
                        <span class="font-bold text-sm text-slate-700">${item}</span>
                        <div class="flex gap-2">
                            <button onclick="this.innerHTML='<i class=\\'fa-solid fa-check\\'></i> OK'; this.className='text-[10px] font-bold text-green-600 bg-green-100 px-3 py-2 rounded'" class="text-[10px] font-bold text-slate-400 bg-slate-50 px-3 py-2 rounded hover:bg-green-50">OK</button>
                            <button onclick="openModal('${item}')" class="text-[10px] font-bold text-red-600 bg-red-100 px-3 py-2 rounded hover:bg-red-200 shadow-sm"><i class="fa-solid fa-wrench"></i> PROBLEMA</button>
                        </div>
                    </div>`;
                });
            }
        }

        let currentItem = '';
        function openModal(item) {
            currentItem = item;
            document.getElementById('modal-title').innerText = item;
            document.getElementById('input-club-price').value = '';
            document.getElementById('input-market-price').value = '';
            document.getElementById('mech-modal').classList.remove('hidden');
            document.getElementById('mech-modal').classList.add('flex');
            
            // Reseta uploads visuais
            document.querySelectorAll('.upload-box').forEach(box => {
                box.classList.remove('filled');
                if(box.innerText.includes('VELHA')) box.innerHTML = '<i class="fa-solid fa-camera mb-1"></i><span class="text-[9px] font-bold">PE√áA VELHA<br>(DANIFICADA)</span>';
                else if(box.innerText.includes('NOVA')) box.innerHTML = '<i class="fa-solid fa-box-open mb-1"></i><span class="text-[9px] font-bold">PE√áA NOVA<br>(COMO DEVE SER)</span>';
                else box.innerHTML = '<i class="fa-solid fa-video"></i> <span class="text-[10px] font-bold">V√çDEO DO PROBLEMA (10s)</span>';
            });
        }

        function closeModal() {
            document.getElementById('mech-modal').classList.add('hidden');
            document.getElementById('mech-modal').classList.remove('flex');
        }

        // C√ÅLCULO AUTOM√ÅTICO DE MERCADO (+40%)
        function calcMarketPrice() {
            const clubPrice = parseFloat(document.getElementById('input-club-price').value);
            if(!isNaN(clubPrice)) {
                const marketPrice = clubPrice * 1.40; // Adiciona 40%
                document.getElementById('input-market-price').value = marketPrice.toLocaleString('pt-BR', {minimumFractionDigits: 2});
            }
        }

        function fakeUpload(el) {
            el.classList.add('filled');
            el.innerHTML = '<i class="fa-solid fa-check text-2xl text-green-500"></i>';
        }

        function confirmIssue() {
            const clubVal = document.getElementById('input-club-price').value;
            const marketVal = document.getElementById('input-market-price').value;
            
            if(!clubVal) return alert('Digite o valor Clube Motors');

            // Remove anterior se houver e adiciona novo
            issues = issues.filter(i => i.name !== currentItem);
            issues.push({ name: currentItem, club: clubVal, market: marketVal });
            localStorage.setItem('cm_issues', JSON.stringify(issues));
            
            closeModal();
            renderChecklist();
        }

        function sendBudget() {
            if(issues.length === 0) return alert('Nenhum problema apontado. Marque pelo menos um item como Problema para testar.');
            localStorage.setItem('cm_stage', 'budget'); // Muda estado global
            alert('‚úÖ Or√ßamento enviado ao Cliente!');
            location.reload();
        }


        // --- L√ìGICA CLIENTE ---
        function updateClientUI() {
            const stage = localStorage.getItem('cm_stage') || 'analyzing';
            const issuesData = JSON.parse(localStorage.getItem('cm_issues') || '[]');

            // Atualiza Timeline (Bolinhas e Opacidade)
            document.getElementById('dot-analyzing').className = 'dot';
            document.getElementById('dot-budget').className = 'dot';
            document.getElementById('dot-maintenance').className = 'dot';
            document.getElementById('dot-ready').className = 'dot';
            
            document.getElementById('step-budget').classList.add('opacity-50');
            document.getElementById('step-maintenance').classList.add('opacity-50');
            document.getElementById('step-ready').classList.add('opacity-50');

            // Ativa etapa correta
            if(stage === 'analyzing') document.getElementById('dot-analyzing').className = 'dot current';
            if(stage === 'budget') {
                document.getElementById('dot-analyzing').className = 'dot active';
                document.getElementById('dot-budget').className = 'dot current';
                document.getElementById('step-budget').classList.remove('opacity-50');
            }
            if(stage === 'maintenance') {
                document.getElementById('dot-analyzing').className = 'dot active';
                document.getElementById('dot-budget').className = 'dot active';
                document.getElementById('dot-maintenance').className = 'dot current';
                document.getElementById('step-budget').classList.remove('opacity-50');
                document.getElementById('step-maintenance').classList.remove('opacity-50');
            }
            if(stage === 'ready') {
                document.getElementById('dot-analyzing').className = 'dot active';
                document.getElementById('dot-budget').className = 'dot active';
                document.getElementById('dot-maintenance').className = 'dot active';
                document.getElementById('dot-ready').className = 'dot current';
                document.getElementById('step-budget').classList.remove('opacity-50');
                document.getElementById('step-maintenance').classList.remove('opacity-50');
                document.getElementById('step-ready').classList.remove('opacity-50');
            }

            // Mostra Conte√∫do Correto
            document.getElementById('state-waiting').classList.add('hidden');
            document.getElementById('state-budget').classList.add('hidden');
            document.getElementById('state-maintenance').classList.add('hidden');
            document.getElementById('state-ready').classList.add('hidden');

            if(stage === 'analyzing') {
                document.getElementById('state-waiting').classList.remove('hidden');
            } else if (stage === 'budget') {
                document.getElementById('state-budget').classList.remove('hidden');
                renderClientBudget(issuesData);
            } else if (stage === 'maintenance') {
                document.getElementById('state-maintenance').classList.remove('hidden');
            } else if (stage === 'ready') {
                document.getElementById('state-ready').classList.remove('hidden');
            }
        }

        function renderClientBudget(issuesList) {
            const container = document.getElementById('budget-list');
            container.innerHTML = '';
            let total = 0;

            issuesList.forEach((issue, idx) => {
                total += parseFloat(issue.club);
                container.innerHTML += `
                <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                    <div class="p-3 bg-slate-50 border-b border-slate-100 font-bold text-slate-700 flex justify-between">
                        ${issue.name}
                        <span class="text-[10px] bg-red-100 text-red-600 px-2 py-1 rounded uppercase">Cr√≠tico</span>
                    </div>
                    <div class="p-4">
                         <div class="grid grid-cols-2 gap-2 mb-3">
                            <div class="bg-slate-200 h-16 rounded flex items-center justify-center text-xs text-slate-400 font-bold">SUA PE√áA</div>
                            <div class="bg-green-100 h-16 rounded flex items-center justify-center text-xs text-green-600 font-bold border border-green-200">PE√áA NOVA</div>
                        </div>
                        <div class="flex justify-between items-center mb-1">
                            <span class="text-xs text-slate-400 line-through">Mercado: R$ ${issue.market}</span>
                            <span class="text-lg font-black text-green-600">R$ ${parseFloat(issue.club).toLocaleString('pt-BR', {minimumFractionDigits: 2})}</span>
                        </div>
                        <button onclick="this.innerHTML='APROVADO'; this.className='w-full bg-slate-100 text-slate-400 font-bold py-2 rounded-lg cursor-default'" class="w-full bg-green-100 hover:bg-green-600 hover:text-white text-green-700 font-bold py-2 rounded-lg transition text-xs">APROVAR ITEM</button>
                    </div>
                </div>`;
            });
            document.getElementById('total-amount').innerText = "R$ " + total.toLocaleString('pt-BR', {minimumFractionDigits: 2});
        }

        function authorizeService() {
            localStorage.setItem('cm_stage', 'maintenance');
            alert('Servi√ßo Autorizado!');
            updateClientUI();
        }

        function advanceToReady() {
            localStorage.setItem('cm_stage', 'ready');
            updateClientUI();
            document.getElementById('view-client').querySelector('.overflow-y-auto').scrollTop = 0;
        }

    </script>
</body>
</html>
